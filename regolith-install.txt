# Register the Regolith public key to your local apt
curl -s https://archive.regolith-desktop.com/regolith.key | gpg --dearmor | sudo tee /usr/share/keyrings/regolith-archive-keyring.gpg > /dev/null

# Add the repository URL to your local apt
echo deb "[arch=amd64 signed-by=/usr/share/keyrings/regolith-archive-keyring.gpg] https://archive.regolith-desktop.com/ubuntu/stable noble v3.3" | \
sudo tee /etc/apt/sources.list.d/regolith.list

# Update apt
sudo apt update && sudo apt dist-upgrade -y

### install regolith
sudo apt install -y regolith-desktop regolith-session-flashback regolith-look-blackhole lightdm
sudo apt remove -y gdm3
sudo apt install -y regolith-system-ubuntu 

### allow networking via applet
sudo apt install -y regolith-wm-networkmanager
sudo systemctl disable systemd-networkd-wait-online.service && sudo systemctl mask systemd-networkd-wait-online.service
echo "network:\n  version:2\n  renderer:NetworkManager" | sudo tee /etc/netplan/50-cloud-init.yaml

### regolith customizations
sudo apt install -y i3xrocks-battery
mkdir -p ~/.config/regolith3/i3xrocks/conf.d/
echo "command=/usr/share/i3xrocks/scripts/$BLOCK_NAME\nseparator_block_width=35\nmarkup=pango\ncolor=xresource:i3xrocks.value.color\nlabel_color=xresource:i3xrocks.label.color" > ~/.config/regolith3/i3xrocks/conf.d/01_setup
echo "[battery]\ninterval=10" > ~/.config/regolith3/i3xrocks/conf.d/80_battery
echo "[time]\ncommand=date '+%Y-%m-%d %H:%M:%S'\ninterval=5" > ~/.config/regolith3/i3xrocks/conf.d/99_custom


### make gnome terminal readable to old eyes
dconf dump /org/gnome/terminal/ | sed "s/^font='.*'/font='Monospace 16'/" | dconf load /org/gnome/terminal/

### shell personalization - zsh + oh my zsh
sudo apt install -y zsh
sudo chsh -s $(which zsh) $(whoami)
echo "n" | ZSH= sh -c "$(curl -fsSL https://raw.githubusercontent.com/ohmyzsh/ohmyzsh/master/tools/install.sh)"

### add some software through apt
sudo apt install -y firefox kicad freecad

### add arduino from zip file, add desktop file
if [ -d "$(PWD)/Arduino/" ]; then
    echo "~/Arduino/ already exists - skipping step"
else
    mkdir ~/Arduino/
    curl https://downloads.arduino.cc/arduino-ide/arduino-ide_2.3.6_Linux_64bit.zip -o /tmp/arduino-idea-2.zip
    unzip /tmp/arduino-idea-2.zip -d ~/Arduino/
    ln -s $(PWD)/Arduino/arduino-ide_2.3.3_Linux_64bit/Arduino-IDE-2.desktop /usr/share/applications/
    rm /tmp/arduino-idea-2.zip
fi

sudo reboot

